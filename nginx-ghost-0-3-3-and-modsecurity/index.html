<!doctype html><html lang=en-us><head><title>nginx, ghost 0.3.3 and modsecurity // A fractal spectrum of tales</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.139.4"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Marcello Seri"><meta name=description content="Free thoughts of a geeky mathematician"><meta http-equiv=Permissions-Policy content="interest-cohort=()"><link rel=stylesheet href=https://www.mseri.me/css/main.min.c4ca4f72de6fc37ec0fb6cccae6509383629f003f020a0dbda31cb08dd2d525f.css><meta name=twitter:card content="summary"><meta name=twitter:title content="nginx, ghost 0.3.3 and modsecurity"><meta name=twitter:description content="In my previous post, Ghost on Amazon EC2 without using sudo, I was proposing some way of running ghost without having to use sudo and with at least a minimal eye on security.
If you have followed one of the guides that I suggested, namely Dude Looks Like a Ghost, or you have installed your own modsecurity configuration you should have received a big page announcing an Error 403 right after the update of your ghost to version 0.3.3."><meta property="og:url" content="https://www.mseri.me/nginx-ghost-0-3-3-and-modsecurity/"><meta property="og:site_name" content="A fractal spectrum of tales"><meta property="og:title" content="nginx, ghost 0.3.3 and modsecurity"><meta property="og:description" content="In my previous post, Ghost on Amazon EC2 without using sudo, I was proposing some way of running ghost without having to use sudo and with at least a minimal eye on security.
If you have followed one of the guides that I suggested, namely Dude Looks Like a Ghost, or you have installed your own modsecurity configuration you should have received a big page announcing an Error 403 right after the update of your ghost to version 0.3.3."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2013-10-18T11:00:00+00:00"><meta property="article:modified_time" content="2013-10-29T15:59:25+00:00"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="Modsecurity"><meta property="article:tag" content="Fix"><meta property="article:tag" content="Ghost"></head><body><header class=app-header><a href=https://www.mseri.me/><img class=app-header-avatar src=/images/gauss_logo.png alt="Marcello Seri"></a><h1>A fractal spectrum of tales</h1><p>Free thoughts of a geeky mathematician</p><div class=app-header-social><a target=_blank href=https://github.com/mseri rel="noreferrer noopener me"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a>
<a target=_blank href=https://mathstodon.xyz/@mseri rel="noreferrer noopener me"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mastodon"><title>mastodon</title><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18.648 15.254C16.832 17.017 12 16.88 12 16.88a18.262 18.262.0 01-3.288-.256c1.127 1.985 4.12 2.81 8.982 2.475-1.945 2.013-13.598 5.257-13.668-7.636L4 10.309c0-3.036.023-4.115 1.352-5.633C7.023 2.766 12 3.01 12 3.01s4.977-.243 6.648 1.667C19.977 6.195 20 7.274 20 10.31s-.456 4.074-1.352 4.944z"/><path d="M12 11.204V8.278C12 7.02 11.105 6 10 6S8 7.02 8 8.278V13m4-4.722C12 7.02 12.895 6 14 6s2 1.02 2 2.278V13"/></svg></a>
<a target=_blank href=https://bsky.app/profile/mseri.me rel="noreferrer noopener me"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a>
<a target=_blank href=https://academic.mseri.me rel="noreferrer noopener me"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-award"><title>award</title><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg></a></div><div style=margin-top:30px><h3 style=margin-bottom:10px>My podcasts</h4><a href=https://podcasters.spotify.com/pod/show/not-just-numbers><img src=/images/njn.jpg alt="Cover of the pocast it's not just numbers" class=image width=105px>
</a>&nbsp;
<a href=https://linktr.ee/degreesoffreedom><img src=/images/dof.jpg alt="Cover of the podcast degrees of freedom" class=image width=105px></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>nginx, ghost 0.3.3 and modsecurity</h1><div class=post-meta><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
Oct 18, 2013</div><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
2 min read</div><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<a class=tag href=https://www.mseri.me/tags/nginx/>Nginx</a><a class=tag href=https://www.mseri.me/tags/modsecurity/>Modsecurity</a><a class=tag href=https://www.mseri.me/tags/fix/>Fix</a><a class=tag href=https://www.mseri.me/tags/ghost/>Ghost</a></div></div></header><div class=post-content><p>In my previous post, <a href=https://www.mseri.me/ghost-on-amazon-ec2-without-using-sudo/>Ghost on Amazon EC2 without using sudo</a>, I was proposing some way of running ghost without having to use sudo and with at least a minimal eye on security.</p><p>If you have followed one of the guides that I suggested, namely <a href=https://blog.igbuend.com/dude-looks-like-a-ghost/>Dude Looks Like a Ghost</a>, or you have installed your own <a href=https://www.modsecurity.org>modsecurity</a> configuration you should have received a big page announcing an <strong>Error 403</strong> right after the update of your ghost to version <em>0.3.3</em>.</p><p><strong>Don&rsquo;t worry!</strong></p><p>Due to some security fixes in the last ghost version, modsecurity interpret the content of your ghost&rsquo;s <a href=https://en.wikipedia.org/wiki/HTTP_cookie>cookie</a> as an <a href=https://en.wikipedia.org/wiki/SQL_injection>sql injection</a> potential attack and simply drops the communication between the browser and the website to prevent it.</p><p>If I understood what expressjs/connect are doing under the hood, there should be no problem in dropping the rule that creates this false positive from the modsecrutiry configuration. The faster way (assuming that you don&rsquo;t need this rule somewhere else) is to comment it in the configuration file</p><pre><code>::sh
sed -i '/981246/s/^/# /' modsecurity_crs_41_sql_injection_attacks.conf
</code></pre><p>and then reload <a href=https://nginx.org>nginx</a></p><pre><code>::sh
/opt/nginx/sbin/nginx -s reload
</code></pre><p>Otherwise you should <a href=https://github.com/SpiderLabs/ModSecurity/wiki/Reference-Manual#secruleremovebyid>selectively remove</a> the rule for the subdomain that is pointing to your ghost instance. But I suppose that if you need this last configuration you already know how to do it&mldr;</p></div><div class=post-footer><script src=https://utteranc.es/client.js repo=mseri/mseri.github.io issue-term=pathname label=âœ¨ðŸ’¬âœ¨ theme=photon-dark crossorigin=anonymous async></script></div></article></main><script>document.addEventListener("DOMContentLoaded",function(){var e='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>',t='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';function n(e){var t,o=e.querySelector("code"),n=o||e,s=n.querySelectorAll('span[style*="display:flex"] > span');return s.length>0?(t=[],s.forEach(function(e){t.push(e.textContent)}),t.join("").replace(/\n$/,"")):n.innerText.replace(/\n$/,"")}document.querySelectorAll("pre").forEach(function(s){var o=document.createElement("button");o.className="copy-code-btn",o.setAttribute("aria-label","Copy code"),o.setAttribute("title","Copy code"),o.innerHTML=e,s.appendChild(o),o.addEventListener("click",function(){var i=n(s);navigator.clipboard.writeText(i).then(function(){o.classList.add("copied"),o.setAttribute("aria-label","Copied!"),o.setAttribute("title","Copied!"),o.innerHTML=t,setTimeout(function(){o.classList.remove("copied"),o.setAttribute("aria-label","Copy code"),o.setAttribute("title","Copy code"),o.innerHTML=e},2e3)})})})})</script></body></html>